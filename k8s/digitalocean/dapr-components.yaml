# Dapr Components for DOKS - Phase V
---
# State Store (Redis)
apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: statestore
  namespace: todo-app
spec:
  type: state.redis
  version: v1
  metadata:
    - name: redisHost
      value: "redis-master.todo-app.svc.cluster.local:6379"
    - name: redisPassword
      value: ""
    - name: actorStateStore
      value: "true"
---
# Pub/Sub (Kafka)
apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: pubsub
  namespace: todo-app
spec:
  type: pubsub.kafka
  version: v1
  metadata:
    - name: brokers
      value: "kafka-headless.todo-app.svc.cluster.local:9092"
    - name: consumerGroup
      value: "todo-app-consumer-group"
    - name: authRequired
      value: "false"
    - name: maxMessageBytes
      value: "1048576"
---
# Cron Binding for Recurring Tasks
apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: recurring-tasks-cron
  namespace: todo-app
spec:
  type: bindings.cron
  version: v1
  metadata:
    - name: schedule
      value: "0 * * * *"  # Every hour
    - name: direction
      value: "input"
---
# Secret Store
apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: kubernetes-secrets
  namespace: todo-app
spec:
  type: secretstores.kubernetes
  version: v1
---
# Dapr Configuration
apiVersion: dapr.io/v1alpha1
kind: Configuration
metadata:
  name: todo-app-config
  namespace: todo-app
spec:
  tracing:
    samplingRate: "1"
    zipkin:
      endpointAddress: "http://zipkin.todo-app.svc.cluster.local:9411/api/v2/spans"
  metric:
    enabled: true
  mtls:
    enabled: true
    workloadCertTTL: "24h"
    allowedClockSkew: "15m"
---
# Subscription for task events
apiVersion: dapr.io/v2alpha1
kind: Subscription
metadata:
  name: task-events-subscription
  namespace: todo-app
spec:
  pubsubname: pubsub
  topic: task-events
  routes:
    default: /api/v1/events/task
---
# Subscription for notifications
apiVersion: dapr.io/v2alpha1
kind: Subscription
metadata:
  name: notifications-subscription
  namespace: todo-app
spec:
  pubsubname: pubsub
  topic: notifications
  routes:
    default: /api/v1/events/notification
